MOVE_DURATION EQU 0x2D5190
ROTATE_DURATION EQU 0x10E24AE

	AREA |.text|, CODE, READONLY
	ENTRY
	EXPORT __main

	IMPORT MOTOR_INIT
	IMPORT MOTOR_RIGHT_ON
	IMPORT MOTOR_RIGHT_OFF
	IMPORT MOTOR_RIGHT_FORWARD
	IMPORT MOTOR_RIGHT_BACKWARD
;	IMPORT MOTOR_RIGHT_TOGGLE
	IMPORT MOTOR_LEFT_ON
	IMPORT MOTOR_LEFT_OFF
	IMPORT MOTOR_LEFT_FORWARD
	IMPORT MOTOR_LEFT_BACKWARD
;	IMPORT MOTOR_LEFT_TOGGLE

	IMPORT LED_INIT
	IMPORT LED_RIGHT_ON
	IMPORT LED_RIGHT_OFF
	IMPORT LED_RIGHT_TOGGLE
;	IMPORT LED_LEFT_ON
	IMPORT LED_LEFT_OFF
	IMPORT LED_LEFT_TOGGLE

	IMPORT SWITCH_INIT
	IMPORT SWITCH_1_PRESSED
;	IMPORT SWITCH_1_PRESSED_ONCE
;	IMPORT SWITCH_1_RELEASED_ONCE
	IMPORT SWITCH_1_WAIT_UNTIL_PRESSED
	IMPORT SWITCH_2_PRESSED
;	IMPORT SWITCH_2_PRESSED_ONCE
;	IMPORT SWITCH_2_RELEASED_ONCE
;	IMPORT SWITCH_2_WAIT_UNTIL_PRESSED
;	IMPORT SWITCH_BOTH_WAIT_UNTIL_PRESSED

	IMPORT BUMPER_INIT
;	IMPORT BUMPER_RIGHT_PRESSED
;	IMPORT BUMPER_LEFT_PRESSED
;	IMPORT BUMPER_BOTH_PRESSED
	IMPORT BUMPER_ANY_PRESSED

__main
	; Initialisation
	BL MOTOR_INIT
	BL LED_INIT
	BL SWITCH_INIT
	BL BUMPER_INIT

    BL LED_LEFT_OFF
    BL LED_RIGHT_OFF
    BL MOTOR_LEFT_OFF
    BL MOTOR_RIGHT_OFF

    BL SWITCH_1_WAIT_UNTIL_PRESSED

    BL MOTOR_LEFT_ON
    BL MOTOR_RIGHT_ON

__move_start
    BL MOTOR_LEFT_FORWARD
    BL MOTOR_RIGHT_FORWARD
    
    LDR R5, =MOVE_DURATION

__move_loop
    BL BUMPER_ANY_PRESSED
    BEQ __rotate_start_left

    SUBS R5, #1
    BEQ __rotate_start_right

    B __move_loop

__rotate_start_left
    BL MOTOR_LEFT_BACKWARD
    BL MOTOR_RIGHT_FORWARD

    LDR R4, =ROTATE_DURATION
    B __rotate_loop

__rotate_start_right
    BL MOTOR_LEFT_FORWARD
    BL MOTOR_RIGHT_BACKWARD

    LDR R4, =ROTATE_DURATION
    ; B __rotate_loop

__rotate_loop
    SUBS R4, #1
    BEQ __move_start

    B __rotate_loop

	NOP
	END
