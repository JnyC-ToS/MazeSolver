LED_BLINKING_FREQUENCY EQU 0x4FFFF

	AREA |.text|, CODE, READONLY
	ENTRY
	EXPORT __main

	IMPORT MOTOR_INIT
	IMPORT MOTOR_RIGHT_ON
	IMPORT MOTOR_RIGHT_OFF
	IMPORT MOTOR_RIGHT_FORWARD
;	IMPORT MOTOR_RIGHT_BACKWARD
;	IMPORT MOTOR_RIGHT_TOGGLE
	IMPORT MOTOR_LEFT_ON
	IMPORT MOTOR_LEFT_OFF
	IMPORT MOTOR_LEFT_FORWARD
	IMPORT MOTOR_LEFT_BACKWARD
;	IMPORT MOTOR_LEFT_TOGGLE

	IMPORT LED_INIT
	IMPORT LED_RIGHT_ON
	IMPORT LED_RIGHT_OFF
	IMPORT LED_RIGHT_TOGGLE
;	IMPORT LED_LEFT_ON
	IMPORT LED_LEFT_OFF
	IMPORT LED_LEFT_TOGGLE

	IMPORT SWITCH_INIT
	IMPORT SWITCH_1_PRESSED
;	IMPORT SWITCH_1_PRESSED_ONCE
;	IMPORT SWITCH_1_RELEASED_ONCE
	IMPORT SWITCH_1_WAIT_UNTIL_PRESSED
	IMPORT SWITCH_2_PRESSED
;	IMPORT SWITCH_2_PRESSED_ONCE
;	IMPORT SWITCH_2_RELEASED_ONCE
;	IMPORT SWITCH_2_WAIT_UNTIL_PRESSED
;	IMPORT SWITCH_BOTH_WAIT_UNTIL_PRESSED

	IMPORT BUMPER_INIT
;	IMPORT BUMPER_RIGHT_PRESSED
;	IMPORT BUMPER_LEFT_PRESSED
;	IMPORT BUMPER_BOTH_PRESSED
	IMPORT BUMPER_ANY_PRESSED

__main
	; Initialisation
	BL MOTOR_INIT
	BL LED_INIT
	BL SWITCH_INIT
	BL BUMPER_INIT

__start
	; Moteurs et LEDs éteints
	BL MOTOR_RIGHT_OFF
	BL MOTOR_LEFT_OFF
	BL LED_RIGHT_OFF
	BL LED_LEFT_OFF

	; Bouton 1 pour démarrer
	BL SWITCH_1_WAIT_UNTIL_PRESSED

	; Allumage moteurs
	BL MOTOR_RIGHT_ON
	BL MOTOR_LEFT_ON

__start_move
	; Moteurs vers l'avant
	BL MOTOR_RIGHT_FORWARD
	BL MOTOR_LEFT_FORWARD
	BL LED_RIGHT_OFF
	BL LED_LEFT_OFF

__loop_move
	; Rotation en cas de collision
	BL BUMPER_ANY_PRESSED
	BEQ __start_rotate

	; Bouton 2 pour arrêter
	BL SWITCH_2_PRESSED
	BEQ __start

	B __loop_move

__start_rotate
	; Moteurs en rotation gauche
	BL MOTOR_RIGHT_FORWARD
	BL MOTOR_LEFT_BACKWARD
	BL LED_RIGHT_ON
	BL LED_LEFT_OFF

__toggle_leds
	; Inverser l'état des LEDs
	BL LED_RIGHT_TOGGLE
	BL LED_LEFT_TOGGLE
	LDR R4, =LED_BLINKING_FREQUENCY

__loop_rotate
	; Bouton 1 pour avancer
	BL SWITCH_1_PRESSED
	BEQ __start_move

	; Bouton 2 pour arrêter
	BL SWITCH_2_PRESSED
	BEQ __start

	; Compteur pour l'inversion des LEDs
	SUBS R4, #1
	BEQ __toggle_leds

	B __loop_rotate

	NOP
	END
